# Story 2.7: Add Responsive Images and Media Optimization

## Status
Draft

## Story

**As a** visitor,
**I want** images to load quickly and look sharp on my device,
**so that** the portfolio feels professional and performs well.

## Acceptance Criteria

1. All images use Next.js Image component with appropriate sizes
2. Images are served in WebP format with fallbacks
3. Responsive image sizing configured (different resolutions for different viewports)
4. Lazy loading enabled for below-the-fold images
5. All images have descriptive alt text for accessibility
6. No Cumulative Layout Shift from images (aspect ratios defined)
7. Image optimization verified with Lighthouse (no unoptimized images warnings)

## Tasks / Subtasks

- [ ] Audit existing images across all pages (AC: 1)
  - [ ] Review Hero section (Story 1.5): avatar/profile image
  - [ ] Review About page (Story 2.1): optional professional photo
  - [ ] Review Projects page (Story 2.3): project thumbnail images
  - [ ] Verify all images use Next.js Image component (should already be using)
  - [ ] List any images not using Next.js Image (fix if found)

- [ ] Verify Next.js Image configuration (AC: 2)
  - [ ] Open `next.config.js`
  - [ ] Check images configuration exists:
    ```js
    module.exports = {
      images: {
        formats: ['image/webp', 'image/avif'], // Modern formats
      },
    };
    ```
  - [ ] Verify WebP format is enabled (default in Next.js 14+)
  - [ ] No additional configuration needed (Next.js handles optimization)

- [ ] Optimize image files (AC: 2, 7)
  - [ ] Review all images in `public/images/`
  - [ ] Convert images to WebP format if not already
  - [ ] Tools for conversion: Squoosh.app, Sharp, or online converters
  - [ ] Target file sizes:
    - [ ] Avatars/profile photos: < 100KB
    - [ ] Project thumbnails: < 200KB
    - [ ] Hero images: < 300KB
  - [ ] Compress images without visible quality loss

- [ ] Configure responsive image sizing (AC: 1, 3)
  - [ ] Hero section image: Add sizes prop for responsive loading
    ```tsx
    <Image
      src="/images/avatar.webp"
      alt="..."
      width={400}
      height={400}
      sizes="(max-width: 768px) 200px, 400px"
      priority
    />
    ```
  - [ ] Project thumbnails: Configure sizes for grid layout
    ```tsx
    <Image
      src={thumbnail}
      alt="..."
      fill
      sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
      className="object-cover"
    />
    ```
  - [ ] About page images: Add appropriate sizes based on layout

- [ ] Implement lazy loading strategy (AC: 4)
  - [ ] Hero section: `priority={true}` (above fold, load immediately)
  - [ ] Project thumbnails: Default lazy loading (Next.js default behavior)
  - [ ] Below-fold images: No props needed (lazy loads automatically)
  - [ ] Verify lazy loading in DevTools Network tab

- [ ] Ensure alt text for all images (AC: 5)
  - [ ] Hero image: `alt="Your Name - Full-Stack Developer"` or descriptive text
  - [ ] Project thumbnails: `alt="{Project Title} project thumbnail"`
  - [ ] About page images: `alt="Professional photo of Your Name"` or relevant description
  - [ ] Review accessibility: Alt text should be descriptive, not generic

- [ ] Prevent Cumulative Layout Shift (AC: 6)
  - [ ] Verify all Image components have width/height OR fill + aspect-ratio container
  - [ ] Hero section: Fixed width/height specified
  - [ ] Project cards: aspect-ratio container (already implemented in Story 2.3)
    ```tsx
    <div className="relative aspect-video">
      <Image src="..." alt="..." fill className="object-cover" />
    </div>
    ```
  - [ ] About page: Fixed dimensions or aspect-ratio container
  - [ ] Test in DevTools: Check for layout shifts during image load

- [ ] Configure image domains (if using external images) (AC: 2)
  - [ ] If using images from external domains (e.g., CDN, Unsplash)
  - [ ] Add to next.config.js:
    ```js
    module.exports = {
      images: {
        remotePatterns: [
          {
            protocol: 'https',
            hostname: 'example.com',
          },
        ],
      },
    };
    ```
  - [ ] Note: For MVP, all images are local (public/images/), no remote domains needed

- [ ] Test image loading performance (AC: 7)
  - [ ] Run `npm run dev`
  - [ ] Open DevTools Network tab
  - [ ] Navigate through all pages (Home, About, Projects, Contact)
  - [ ] Verify images load as WebP format
  - [ ] Check image file sizes (should be optimized)
  - [ ] Verify lazy loading works (images load as you scroll)
  - [ ] Check responsive image srcset (different sizes for different viewports)

- [ ] Run Lighthouse audit (AC: 7)
  - [ ] Run Lighthouse for each page
  - [ ] Check Performance score (target: 90+)
  - [ ] Check for image optimization warnings
  - [ ] Verify no "properly size images" warnings
  - [ ] Verify no "serve images in next-gen formats" warnings
  - [ ] Check Accessibility score for image alt text (target: 100)

- [ ] Test responsive images at different viewports (AC: 3)
  - [ ] Test at mobile (375px): Verify smaller images load
  - [ ] Test at tablet (768px): Verify medium images load
  - [ ] Test at desktop (1920px): Verify larger images load
  - [ ] Use DevTools Network tab to confirm different image sizes served

- [ ] Verify no Cumulative Layout Shift (AC: 6)
  - [ ] Run Lighthouse performance audit
  - [ ] Check CLS score (target: < 0.1)
  - [ ] Test image loading with slow 3G network throttling
  - [ ] Verify no content jumps when images load

- [ ] Deploy and verify live (AC: 1-7)
  - [ ] Commit changes: `git add .` and `git commit -m "Optimize images with responsive sizing and WebP format"`
  - [ ] Push to main: `git push origin main`
  - [ ] Verify Vercel deployment succeeds
  - [ ] Run Lighthouse on production URL
  - [ ] Verify image optimization on live site
  - [ ] Test on actual mobile device for performance

## Dev Notes

### Previous Story Insights
[From Stories 1.5, 2.1, 2.3]
- Hero section uses Next.js Image (Story 1.5)
- Project grid uses Next.js Image with aspect-ratio containers (Story 2.3)
- About page may have professional photo using Next.js Image (Story 2.1)
- All images should already be using Next.js Image component

### Next.js Image Optimization
[Source: [coding-standards.md#critical-fullstack-rules](docs/architecture/coding-standards.md)]

**Image Optimization Features:**
- Automatic WebP/AVIF conversion
- Responsive image sizing (srcset generation)
- Lazy loading by default (except priority images)
- On-demand optimization (images optimized at request time)
- Edge caching (optimized images cached on Vercel Edge Network)

**Always Use Next.js Image:**
- Never use `<img>` tags
- Always include alt text
- Provide width/height or use fill prop

### Image Configuration
[Source: [tech-stack.md](docs/architecture/tech-stack.md)]

**next.config.js Configuration:**
```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    formats: ['image/webp', 'image/avif'], // Modern formats (default in Next.js 14+)
  },
};

module.exports = nextConfig;
```

**No additional configuration needed for local images in /public**

### Responsive Image Sizing

**sizes Prop Strategy:**
```tsx
// Hero image (fixed size)
sizes="(max-width: 768px) 200px, 400px"

// Project thumbnails (responsive grid)
sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"

// Full-width images
sizes="100vw"
```

**How sizes Works:**
- Tells browser which image size to load based on viewport
- Generates srcset with multiple image sizes
- Browser chooses appropriate size automatically

### Image Loading Priority

**priority Prop:**
- Use `priority={true}` for above-the-fold images (Hero section)
- Disables lazy loading for critical images
- Ensures LCP (Largest Contentful Paint) is fast

**Lazy Loading (Default):**
- All other images lazy load automatically
- Load when image enters viewport
- Improves initial page load performance

### Preventing Cumulative Layout Shift (CLS)

**Fixed Dimensions:**
```tsx
<Image
  src="/images/avatar.webp"
  alt="..."
  width={400}
  height={400}
/>
```

**Fill with Aspect Ratio:**
```tsx
<div className="relative aspect-video">
  <Image
    src="/images/project.webp"
    alt="..."
    fill
    className="object-cover"
  />
</div>
```

**Aspect Ratio Utilities:**
- `aspect-video`: 16:9 ratio
- `aspect-square`: 1:1 ratio
- `aspect-[4/3]`: Custom 4:3 ratio

### Image Optimization Tools

**WebP Conversion:**
- Squoosh.app (online, Google tool)
- Sharp (Node.js library)
- ImageOptim (Mac app)
- Online converters: CloudConvert, Convertio

**Compression:**
- Target quality: 80-85% for photographs
- Target quality: 90%+ for graphics with text
- Balance: File size vs. visual quality

### File Size Targets
[Source: [security-and-performance.md#performance-optimization](docs/architecture/security-and-performance.md)]

**Recommended Sizes:**
- Avatars/profile photos: < 100KB
- Project thumbnails: < 200KB
- Hero images: < 300KB
- Full-size project images: < 500KB

### Alt Text Best Practices
[Source: [coding-standards.md#critical-fullstack-rules](docs/architecture/coding-standards.md)]

**Descriptive Alt Text:**
- Describe image content, not image file name
- Be specific and concise
- Include relevant context
- Don't start with "Image of..." or "Picture of..."

**Examples:**
- Good: `alt="John Doe, Full-Stack Developer"`
- Bad: `alt="avatar.webp"` or `alt="image"`
- Good: `alt="E-commerce Platform project showing product grid and checkout flow"`
- Bad: `alt="screenshot"`

### Testing Image Optimization

**Lighthouse Metrics:**
- **Performance:** Target 90+
  - LCP (Largest Contentful Paint): < 2.5s
  - CLS (Cumulative Layout Shift): < 0.1
- **Accessibility:** Target 100
  - All images have alt text

**DevTools Network Tab:**
- Check image format (should be WebP or AVIF)
- Check image file sizes (should be optimized)
- Check responsive images (multiple sizes in srcset)

### Project Structure
[Source: [unified-project-structure.md](docs/architecture/unified-project-structure.md)]

**Image Organization:**
```
public/
├── images/
│   ├── avatar.webp           # Profile photo
│   ├── projects/              # Project images
│   │   ├── project-1-thumbnail.webp
│   │   ├── project-2-thumbnail.webp
│   │   └── ...
│   └── og-image.png          # Social sharing image
```

### Performance Optimization Strategy

**Critical Images (Above Fold):**
1. Use `priority={true}`
2. Optimize file size aggressively
3. Use appropriate sizes prop

**Non-Critical Images (Below Fold):**
1. Use default lazy loading
2. Optimize file size reasonably
3. Use appropriate sizes prop

### Vercel Image Optimization

**Automatic Features:**
- WebP/AVIF conversion
- Responsive sizing
- Edge caching (fast delivery globally)
- On-demand optimization (no build-time processing)

**No Configuration Needed:**
- Works out of the box with Next.js Image
- Optimized images cached on Vercel Edge Network
- Free tier includes 1,000 image optimizations

### Testing Checklist

**Manual Tests:**
- [ ] Images load in WebP format (check Network tab)
- [ ] Images are responsive (different sizes at different viewports)
- [ ] Hero image loads immediately (priority)
- [ ] Project images lazy load (load on scroll)
- [ ] No layout shift when images load
- [ ] All images have descriptive alt text

**Lighthouse Tests:**
- [ ] Performance score 90+
- [ ] No image optimization warnings
- [ ] CLS score < 0.1
- [ ] Accessibility score 100 (alt text present)

### Integration with Future Stories

This image optimization provides:
- Fast page load times
- Professional user experience
- SEO benefits (Core Web Vitals)
- Accessibility compliance
- Foundation for project detail images (Epic 3)

### Technical Constraints

**Vercel Limits (Free Tier):**
- 1,000 optimized images per deployment
- Sufficient for portfolio (< 20 images expected)
- Images cached, so count doesn't increase with traffic

**Browser Support:**
- WebP: All modern browsers
- AVIF: Most modern browsers (Safari 16+)
- Fallback: Next.js serves optimized JPEG/PNG if needed

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-02 | 1.0 | Initial story draft created | Scrum Master (Bob) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used

*To be filled by Dev Agent*

### Debug Log References

*To be filled by Dev Agent*

### Completion Notes List

*To be filled by Dev Agent*

### File List

*To be filled by Dev Agent*

## QA Results

*This section will be populated by QA Agent after story completion*
